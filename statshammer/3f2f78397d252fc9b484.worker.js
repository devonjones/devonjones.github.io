!function(t){function n(e){if(r[e])return r[e].exports;var i=r[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,n),i.l=!0,i.exports}var r={};n.m=t,n.c=r,n.d=function(t,r,e){n.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:e})},n.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(r,"a",r),r},n.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.p="/statshammer/",n(n.s=0)}([function(t,n,r){"use strict";function e(t,n){if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r]instanceof Array){if(!e(t[r],n[r]))return!1}else if(t[r]!==n[r])return!1;return!0}function i(t){var n=[];return t.forEach(function(t){n.push(t.slice())}),n}function u(t){if(t instanceof Array){if(0===t.length)return!1;for(var n=0;n<t.length;n++){if(!u(t[n]))return!1}}return!0}function o(t,n){return!!u(t)&&(!!u(n)&&e(a(t),a(n)))}function a(t){var n=t.map(function(t){return t.reduce(function(t,n){return t+n})}),r=[];return t.forEach(function(t,e){r.push(t.map(function(t){return Math.round(t/n[e]*1e3)/10}))}),r}function s(t){return t.map(function(t){if(t.attackCountDice){return D.a.roll(t.attackCountDice).total}return t.attackCountNumber?t.attackCountNumber:0})}function l(t,n,r){return r.map(function(n,r){return n?D.a.roll(n+"d6").rolls.map(function(n){return 1!==n&&n>=t[r].skill}):[]}).map(function(t){return t.filter(function(t){return t}).length})}function f(t){if(t.strengthDice){return D.a.roll(t.strengthDice).total}return t.strengthNumber?t.strengthNumber:1}function c(t,n,r){function e(t,n){return t>=2*n?2:t>n?3:t===n?4:t<n?5:t<n/2?6:void 0}return r.map(function(r,i){return r?D.a.roll(r+"d6").rolls.map(function(r){if(n){var u=e(f(t[i]),n.toughness);return 1!==r&&r>=u}return""}):[]}).map(function(t){return t.filter(function(t){return t}).length})}function m(t,n,r){return r.map(function(r,e){return r?D.a.roll(r+"d6").rolls.map(function(r){if(1===r)return!0;var i=n.save+t[e].ap,u=n.invuln,o=i;return u&&u<i&&(o=u),r<o}):[]}).map(function(t){return t.filter(function(t){return t}).length})}function h(t,n,r){var e=r.map(function(n,r){var e=[];if(n)for(var i=0;i<n;i++)t[r].damageDice?e.push(D.a.roll(t[r].damageDice).total):t[r].damageNumber&&e.push(t[r].damageNumber);return e});return{damageValues:e,damageTotals:e.map(function(t){return t.length>0?t.reduce(function(t,n){return t+n}):0})}}function d(t,n,r){return r.map(function(t,r){var e=n.wounds,i=0;return t.forEach(function(t){(e-=t)<1&&(i+=1,e=n.wounds)}),i})}function p(t,n){var r={};r.shots=s(t),r.hits=l(t,n,r.shots),r.wounds=c(t,n,r.hits),r.unsaved=m(t,n,r.wounds);var e=h(t,n,r.unsaved),i=e.damageValues,u=e.damageTotals;return r.damage=u,r.allocate=d(t,n,i),r}function g(t,n){var r=t.map(function(){return[]}),e=t.map(function(){return[]}),u=t.map(function(){return[]}),s=t.map(function(){return[]}),l=t.map(function(){return[]}),f=t.map(function(){return[]}),c=!1,m=0;do{var h=i(r),d=i(e),g=i(u),j=i(s),w=i(l),D=i(f);m++;for(var O=0;O<100;O++){var x=p(t,n);r=b(r,x.shots),e=b(e,x.hits),u=b(u,x.wounds),s=b(s,x.unsaved),l=b(l,x.damage),f=b(f,x.allocate)}o(h,r)&&o(d,e)&&o(g,u)&&o(j,s)&&o(w,l)&&o(D,f)&&(c=!0)}while(!c);var y={shots:a(r),hits:a(e),wounds:a(u),unsaved:a(s),damage:a(l),allocate:a(f)};console.log(100*m);var M=v(y,t);return M.meta={iterations:100*m},M}function v(t,n){var r=n.map(function(t){return{id:t.id+"-stats"}}),e=t.shots.map(function(t){return{shots:t}}),i=t.hits.map(function(t){return{hits:t}}),u=t.wounds.map(function(t){return{wounds:t}}),o=t.unsaved.map(function(t){return{unsaved:t}}),a=t.damage.map(function(t){return{damage:t}}),s=t.allocate.map(function(t){return{allocate:t}});return r.map(function(t,n){var r=Object.assign(t,e[n]),l=Object.assign(r,i[n]),f=Object.assign(l,u[n]),c=Object.assign(f,o[n]),m=Object.assign(c,a[n]);return Object.assign(m,s[n])}),r}function b(t,n){var r=i(t);return n.forEach(function(t,n){void 0===r[n][t]?r[n][t]=1:r[n][t]+=1}),r}Object.defineProperty(n,"__esModule",{value:!0});var j=r(1),w=r(2),D=r.n(w);self.addEventListener("message",function(t){var n=t.data,r=n.attacker,e=n.defender,i=g(r,e);self.postMessage(Object(j.a)(i))})},function(t,n,r){"use strict";function e(t){return{type:i,stats:t}}n.a=e;var i="STATS_CALCULATED"},function(t,n){!function(n){"use strict";function r(){this.numDice=0,this.numSides=0,this.modifier=0,this.minResult=0,this.maxResult=0,this.avgResult=0}function e(){this.rolls=[],this.modifier=0,this.total=0}var i={};e.prototype.toString=function(){return 1===this.rolls.length&&0===this.modifier?this.rolls[0]+"":this.rolls.length>1&&0===this.modifier?this.rolls.join(" + ")+" = "+this.total:1===this.rolls.length&&this.modifier>0?this.rolls[0]+" + "+this.modifier+" = "+this.total:this.rolls.length>1&&this.modifier>0?this.rolls.join(" + ")+" + "+this.modifier+" = "+this.total:1===this.rolls.length&&this.modifier<0?this.rolls[0]+" - "+Math.abs(this.modifier)+" = "+this.total:this.rolls.length>1&&this.modifier<0?this.rolls.join(" + ")+" - "+Math.abs(this.modifier)+" = "+this.total:void 0},i.parse=function(t){var n=null,e=new r;return!!(n=t.match(/^([1-9]\d*)?d([1-9]\d*)([+-]\d+)?$/i))&&(e.numDice=n[1]-0||1,e.numSides=n[2]-0,e.modifier=n[3]-0||0,e.minResult=1*e.numDice+e.modifier,e.maxResult=e.numDice*e.numSides+e.modifier,e.avgResult=(e.maxResult+e.minResult)/2,e)},i.validate=function(t){return!!i.parse(t)},i.roll=function(t){var n=null,r=new e;if(!(n=i.parse(t)))return!1;for(var u=0;u<n.numDice;u++)r.rolls[u]=1+Math.floor(Math.random()*n.numSides);r.modifier=n.modifier;for(var o=0;o<r.rolls.length;o++)r.total+=r.rolls[o];return r.total+=r.modifier,r},"undefined"!==typeof t&&t.exports?t.exports=i:n.droll=i}(this)}]);
//# sourceMappingURL=3f2f78397d252fc9b484.worker.js.map