!function(t){function n(e){if(r[e])return r[e].exports;var i=r[e]={i:e,l:!1,exports:{}};return t[e].call(i.exports,i,i.exports,n),i.l=!0,i.exports}var r={};n.m=t,n.c=r,n.d=function(t,r,e){n.o(t,r)||Object.defineProperty(t,r,{configurable:!1,enumerable:!0,get:e})},n.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(r,"a",r),r},n.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},n.p="/statshammer/",n(n.s=0)}([function(t,n,r){"use strict";function e(t){if(Array.isArray(t)){for(var n=0,r=Array(t.length);n<t.length;n++)r[n]=t[n];return r}return Array.from(t)}function i(t,n){if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r]instanceof Array){if(!i(t[r],n[r]))return!1}else if(t[r]!==n[r])return!1;return!0}function o(t){var n=[];return t.forEach(function(t){n.push(t.slice())}),n}function u(t,n,r){var i=[];t&&i.push.apply(i,e(t.filter(function(t){return t.stage===r}))),n&&i.push.apply(i,e(n.filter(function(t){return t.stage===r})));var o={};return i.forEach(function(t){if("optid"in t)o[t.type]=t;else{var n=o[t.type];n||(n=[]),n.push(t),o[t.type]=n}}),o}function a(t){var n=0;return t.modifier&&t.modifier.forEach(function(t){n+=t.value}),n}function s(t){if(t instanceof Array){if(0===t.length)return!1;for(var n=0;n<t.length;n++){if(!s(t[n]))return!1}}return!0}function l(t,n){return!!s(t)&&(!!s(n)&&i(f(t),f(n)))}function f(t){var n=t.map(function(t){return t.reduce(function(t,n){return t+n})}),r=[];return t.forEach(function(t,e){r.push(t.map(function(t){return Math.round(t/n[e]*1e3)/10}))}),r}function c(t){return t.map(function(t){if(t.attackCountDice){return M.a.roll(t.attackCountDice).total}return t.attackCountNumber?t.attackCountNumber:0})}function d(t,n,r){var e=a(r);return"automatic"in r?Array.from({length:t},function(t,n){return!0}):M.a.roll(t+"d6").rolls.map(function(t){if(1===t){if("reroll_one"in r||"reroll_missed"in r){return M.a.roll("1d6").total+e>=n}return t+e>=n}var i=t+e>=n;if(!i&&"reroll_missed"in r){var o=M.a.roll("1d6").total;return 1!==o&&o+e>=n}return i})}function m(t,n,r){var e=a(r);return"automatic"in r?Array.from({length:t},function(t,n){return!0}):M.a.roll(t+"d6").rolls.map(function(t){if(1===t){if("reroll_one"in r||"reroll_missed"in r){var i=M.a.roll("1d6").total;return 1!==i&&i+e>=n}return!1}var o=t+e>=n;if(!o&&"reroll_missed"in r){var u=M.a.roll("1d6").total;return 1!==u&&u+e>=n}return o})}function h(t,n,r){return r.map(function(r,e){if(r){var i=u(t[e].options,n.options,"hits");return m(r,t[e].skill,i)}return[]}).map(function(t){return t.filter(function(t){return t}).length})}function p(t){if(t.strengthDice){return M.a.roll(t.strengthDice).total}return t.strengthNumber?t.strengthNumber:1}function v(t,n,r){function e(t,n){return t>=2*n?2:t>n?3:t===n?4:t<n?5:t<n/2?6:void 0}return r.map(function(r,i){if(r){return m(r,e(p(t[i]),n.toughness),u(t[i].options,n.options,"wounds"))}return[]}).map(function(t){return t.filter(function(t){return t}).length})}function g(t,n){var r=u(n.options,t.options,"saves"),e=u(n.options,t.options,"invulnsaves"),i=t.save+n.ap,o=t.invuln,s=i,l=r;return o&&o+a(r)<i+a(e)&&(s=o,l=e),{target:s,options:l}}function y(t,n,r){return r.map(function(r,e){if(r){var i=g(n,t[e]);return d(r,i.target,i.options).map(function(t){return!t})}return[]}).map(function(t){return t.filter(function(t){return t}).length})}function b(t,n,r,e){if("disgustingly_resilient"in e){var i=u(n.options,r.options,"damage_dr");return t.map(function(t){var n=0;return M.a.roll(t+"d6").rolls.forEach(function(t){if(1===t&&"reroll_one"in i){M.a.roll("1d6").total<e.disgustingly_resilient.value&&(n+=1)}else if(t<e.disgustingly_resilient.value)if("reroll_missed"in i){var r=M.a.roll("1d6").total;r<e.disgustingly_resilient.value&&(n+=1)}else n+=1}),n})}return t}function _(t,n,r){var e=r.map(function(r,e){var i=u(t[e].options,n.options,"damage"),o=[];if(r)for(var a=0;a<r;a++)t[e].damageDice?o.push(M.a.roll(t[e].damageDice).total):t[e].damageNumber&&o.push(t[e].damageNumber);return b(o,t[e],n,i)});return{damageValues:e,damageTotals:e.map(function(t){return t.length>0?t.reduce(function(t,n){return t+n}):0})}}function j(t,n,r){return r.map(function(t,r){var e=n.wounds,i=0;return t.forEach(function(t){(e-=t)<1&&(i+=1,e=n.wounds)}),i})}function w(t,n){var r={};r.shots=c(t),r.hits=h(t,n,r.shots),r.wounds=v(t,n,r.hits),r.unsaved=y(t,n,r.wounds);var e=_(t,n,r.unsaved),i=e.damageValues,o=e.damageTotals;return r.damage=o,r.allocate=j(t,n,i),r}function D(t,n){var r=t.map(function(){return[]}),e=t.map(function(){return[]}),i=t.map(function(){return[]}),u=t.map(function(){return[]}),a=t.map(function(){return[]}),s=t.map(function(){return[]}),c=!1,d=0;do{var m=o(r),h=o(e),p=o(i),v=o(u),g=o(a),y=o(s);d++;for(var b=0;b<100;b++){var _=w(t,n);r=O(r,_.shots),e=O(e,_.hits),i=O(i,_.wounds),u=O(u,_.unsaved),a=O(a,_.damage),s=O(s,_.allocate)}l(m,r)&&l(h,e)&&l(p,i)&&l(v,u)&&l(g,a)&&l(y,s)&&(c=!0)}while(!c);var j={shots:f(r),hits:f(e),wounds:f(i),unsaved:f(u),damage:f(a),allocate:f(s)};console.log(100*d);var D=A(j,t);return D.meta={iterations:100*d},D}function A(t,n){var r=n.map(function(t){return{id:t.id+"-stats"}}),e=t.shots.map(function(t){return{shots:t}}),i=t.hits.map(function(t){return{hits:t}}),o=t.wounds.map(function(t){return{wounds:t}}),u=t.unsaved.map(function(t){return{unsaved:t}}),a=t.damage.map(function(t){return{damage:t}}),s=t.allocate.map(function(t){return{allocate:t}});return r.map(function(t,n){var r=Object.assign(t,e[n]),l=Object.assign(r,i[n]),f=Object.assign(l,o[n]),c=Object.assign(f,u[n]),d=Object.assign(c,a[n]);return Object.assign(d,s[n])}),r}function O(t,n){var r=o(t);return n.forEach(function(t,n){void 0===r[n][t]?r[n][t]=1:r[n][t]+=1}),r}Object.defineProperty(n,"__esModule",{value:!0});var x=r(1),E=r(2),M=r.n(E);self.addEventListener("message",function(t){var n=t.data,r=n.attacker,e=n.defender,i=D(r,e);self.postMessage(Object(x.a)(i))})},function(t,n,r){"use strict";function e(t){return{type:i,stats:t}}n.a=e;var i="STATS_CALCULATED"},function(t,n){!function(n){"use strict";function r(){this.numDice=0,this.numSides=0,this.modifier=0,this.minResult=0,this.maxResult=0,this.avgResult=0}function e(){this.rolls=[],this.modifier=0,this.total=0}var i={};e.prototype.toString=function(){return 1===this.rolls.length&&0===this.modifier?this.rolls[0]+"":this.rolls.length>1&&0===this.modifier?this.rolls.join(" + ")+" = "+this.total:1===this.rolls.length&&this.modifier>0?this.rolls[0]+" + "+this.modifier+" = "+this.total:this.rolls.length>1&&this.modifier>0?this.rolls.join(" + ")+" + "+this.modifier+" = "+this.total:1===this.rolls.length&&this.modifier<0?this.rolls[0]+" - "+Math.abs(this.modifier)+" = "+this.total:this.rolls.length>1&&this.modifier<0?this.rolls.join(" + ")+" - "+Math.abs(this.modifier)+" = "+this.total:void 0},i.parse=function(t){var n=null,e=new r;return!!(n=t.match(/^([1-9]\d*)?d([1-9]\d*)([+-]\d+)?$/i))&&(e.numDice=n[1]-0||1,e.numSides=n[2]-0,e.modifier=n[3]-0||0,e.minResult=1*e.numDice+e.modifier,e.maxResult=e.numDice*e.numSides+e.modifier,e.avgResult=(e.maxResult+e.minResult)/2,e)},i.validate=function(t){return!!i.parse(t)},i.roll=function(t){var n=null,r=new e;if(!(n=i.parse(t)))return!1;for(var o=0;o<n.numDice;o++)r.rolls[o]=1+Math.floor(Math.random()*n.numSides);r.modifier=n.modifier;for(var u=0;u<r.rolls.length;u++)r.total+=r.rolls[u];return r.total+=r.modifier,r},"undefined"!==typeof t&&t.exports?t.exports=i:n.droll=i}(this)}]);
//# sourceMappingURL=1072ea7ee1af4f3aed33.worker.js.map